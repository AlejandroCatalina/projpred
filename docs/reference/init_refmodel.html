<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Custom reference model initialization — init_refmodel • projpred</title>

<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min.js" integrity="sha256-hIvIxeqhGZF+VVeM55k0mJvWpQ6gTkWk3Emc+NmowYA=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Custom reference model initialization — init_refmodel" />

<meta property="og:description" content="Initializes a structure that can be used as a reference fit for the
projective variable selection. This function is provided to allow construction 
of the reference fit from arbitrary fitted models, because only limited
information is needed for the actual projection and variable selection." />

<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">projpred</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="http://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstanarm">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/loo">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org">Stan</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/projpred/">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Custom reference model initialization</h1>
    
    <div class="hidden name"><code>init_refmodel.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Initializes a structure that can be used as a reference fit for the
projective variable selection. This function is provided to allow construction 
of the reference fit from arbitrary fitted models, because only limited
information is needed for the actual projection and variable selection.</p>
    
    </div>

    <pre class="usage"><span class='fu'>init_refmodel</span>(<span class='no'>z</span>, <span class='no'>y</span>, <span class='no'>family</span>, <span class='kw'>x</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>predfun</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>dis</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>offset</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>wobs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>wsample</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>intercept</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>cvfun</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>cvfits</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>z</th>
      <td><p>Predictor matrix of dimension <code>n</code>-by-<code>dz</code> containing the training
features for the reference model. Rows denote the observations and columns the different features.</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>Vector of length <code>n</code> giving the target variable values.</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>family object giving the model family</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>Predictor matrix of dimension <code>n</code>-by-<code>dx</code> containing the candidate
features for selection (i.e. variables from which to select the submodel).  Rows denote
the observations and columns the different features. Notice that this can
different from <code>z</code>. If missing, same as <code>z</code> by default.</p></td>
    </tr>
    <tr>
      <th>predfun</th>
      <td><p>Function that takes a <code>nt</code>-by-<code>dz</code> test predictor matrix <code>zt</code> as an input
(<code>nt</code> = # test points, <code>dz</code> = number of features in the reference model) and outputs
a <code>nt</code>-by-<code>S</code> matrix of expected values for the target variable <code>y</code>,
each column corresponding to one posterior draw for the parameters in the reference model
(the number of draws <code>S</code> can also be 1). Notice that the output should be computed without
any offsets, these are automatically taken into account internally, e.g. in cross-validation.
If omitted, then the returned object will be 'data reference', that is, it can be used to compute
penalized maximum likelihood solutions such as Lasso (see examples below and in the quickstart vignette.)</p></td>
    </tr>
    <tr>
      <th>dis</th>
      <td><p>Vector of length <code>S</code> giving the posterior draws for the dispersion parameter
in the reference model if there is such a parameter in the model family. For Gaussian
observation model this is the noise std <code>sigma</code>.</p></td>
    </tr>
    <tr>
      <th>offset</th>
      <td><p>Offset to be added to the linear predictor in the projection. (Same as in
function <code>glm</code>.)</p></td>
    </tr>
    <tr>
      <th>wobs</th>
      <td><p>Observation weights. If omitted, equal weights are assumed.</p></td>
    </tr>
    <tr>
      <th>wsample</th>
      <td><p>vector of length <code>S</code> giving the weights for the posterior draws. 
If omitted, equal weights are assumed.</p></td>
    </tr>
    <tr>
      <th>intercept</th>
      <td><p>Whether to use intercept. Default is <code>TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>cvfun</th>
      <td><p>Function for performing K-fold cross-validation. The input is an <code>n</code>-element
vector where each value is an integer between 1 and K denoting the fold for each observation.
Should return a list with K elements, each of which is a list with fields <code>predfun</code> and
<code>dis</code> (if the model has a dispersion parameter) which are defined the same way as the arguments 
<code>predfun</code> and <code>dis</code> above but are computed using only the corresponding subset of the data. 
More precisely, if <code>cvres</code> denotes
the list returned by <code>cvfun</code>, then <code>cvres[[k]]$predfun</code> and <code>cvres[[k]]$dis</code> must be computed
using only data from indices <code>folds != k</code>, where <code>folds</code> is the <code>n</code>-element input for
<code>cvfun</code>. Can be omitted but either <code>cvfun</code> or <code>cvfits</code> is needed for K-fold cross-validation
for genuine reference models. See example below.</p></td>
    </tr>
    <tr>
      <th>cvfits</th>
      <td><p>A list with K elements, that has the same format as the value returned by <code>cvind</code> but 
each element of <code>cvfits</code> must also contain a field <code>omitted</code> which indicates the indices that
were left out for the corresponding fold. Usually it is easier to specify <code>cvfun</code> but this can be useful
if you have already computed the cross-validation for the reference model and would like to avoid 
recomputing it. Can be omitted but either <code>cvfun</code> or <code>cvfits</code> is needed for K-fold cross-validation
for genuine reference models.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Currently ignored.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object that can be passed to all the functions that
take the reference fit as the first argument, such as <a href='varsel.html'>varsel</a>, <a href='cv_varsel.html'>cv_varsel</a>,
<a href='proj-pred.html'>proj_predict</a> and <a href='proj-pred.html'>proj_linpred</a>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># generate some toy data</span>
<span class='fu'>set.seed</span>(<span class='fl'>1</span>)
<span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fl'>100</span>
<span class='no'>d</span> <span class='kw'>&lt;-</span> <span class='fl'>10</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>matrix</span>(<span class='fu'>rnorm</span>(<span class='no'>n</span>*<span class='no'>d</span>), <span class='kw'>nrow</span><span class='kw'>=</span><span class='no'>n</span>, <span class='kw'>ncol</span><span class='kw'>=</span><span class='no'>d</span>)
<span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='fu'>c</span>(<span class='fl'>1</span>,<span class='fl'>1</span>),<span class='fu'>rep</span>(<span class='fl'>0</span>,<span class='no'>d</span>-<span class='fl'>2</span>)) <span class='co'># first two variables are relevant</span>
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='no'>x</span> <span class='kw'>%*%</span> <span class='no'>b</span> + <span class='fu'>rnorm</span>(<span class='no'>n</span>)

<span class='co'># fit the model (this uses rstanarm for posterior inference, </span>
<span class='co'># but any other tool could also be used)</span>
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>stan_glm</span>(<span class='no'>y</span>~<span class='no'>x</span>, <span class='kw'>family</span><span class='kw'>=</span><span class='fu'>gaussian</span>(), <span class='kw'>data</span><span class='kw'>=</span><span class='fu'>data.frame</span>(<span class='kw'>x</span><span class='kw'>=</span><span class='fu'>I</span>(<span class='no'>x</span>),<span class='kw'>y</span><span class='kw'>=</span><span class='no'>y</span>))</div><div class='output co'>#&gt; <span class='error'>Error in stan_glm(y ~ x, family = gaussian(), data = data.frame(x = I(x),     y = y)): could not find function "stan_glm"</span></div><div class='input'><span class='no'>draws</span> <span class='kw'>&lt;-</span> <span class='fu'>as.matrix</span>(<span class='no'>fit</span>)</div><div class='output co'>#&gt; <span class='error'>Error in as.matrix(fit): object 'fit' not found</span></div><div class='input'><span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='no'>draws</span>[,<span class='fl'>1</span>] <span class='co'># intercept</span></div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): object 'draws' not found</span></div><div class='input'><span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='no'>draws</span>[,<span class='fl'>2</span>:(<span class='fu'>ncol</span>(<span class='no'>draws</span>)-<span class='fl'>1</span>)] <span class='co'># regression coefficients</span></div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): object 'draws' not found</span></div><div class='input'><span class='no'>sigma</span> <span class='kw'>&lt;-</span> <span class='no'>draws</span>[,<span class='fu'>ncol</span>(<span class='no'>draws</span>)] <span class='co'># noise std</span></div><div class='output co'>#&gt; <span class='error'>Error in eval(expr, envir, enclos): object 'draws' not found</span></div><div class='input'>
<span class='co'># initialize the reference model structure</span>
<span class='no'>predfun</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>xt</span>) <span class='fu'>t</span>( <span class='no'>b</span> <span class='kw'>%*%</span> <span class='fu'>t</span>(<span class='no'>xt</span>) + <span class='no'>a</span> )
<span class='no'>ref</span> <span class='kw'>&lt;-</span> <span class='fu'>init_refmodel</span>(<span class='no'>x</span>,<span class='no'>y</span>, <span class='fu'>gaussian</span>(), <span class='kw'>predfun</span><span class='kw'>=</span><span class='no'>predfun</span>, <span class='kw'>dis</span><span class='kw'>=</span><span class='no'>sigma</span>)</div><div class='output co'>#&gt; <span class='error'>Error in t(b %*% t(xt) + a): object 'a' not found</span></div><div class='input'>
<span class='co'># variable selection based on the reference model</span>
<span class='no'>vs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='cv_varsel.html'>cv_varsel</a></span>(<span class='no'>ref</span>)</div><div class='output co'>#&gt; <span class='error'>Error in get_refmodel(fit, ...): object 'ref' not found</span></div><div class='input'><span class='fu'><a href='varsel-statistics.html'>varsel_plot</a></span>(<span class='no'>vs</span>)</div><div class='output co'>#&gt; <span class='error'>Error in "vsel" %in% class(object): object 'vs' not found</span></div><div class='input'>

<span class='co'># pass in the original data as 'reference'; this allows us to compute </span>
<span class='co'># traditional estimates like Lasso</span>
<span class='no'>dref</span> <span class='kw'>&lt;-</span> <span class='fu'>init_refmodel</span>(<span class='no'>x</span>,<span class='no'>y</span>,<span class='fu'>gaussian</span>())
<span class='no'>lasso</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='cv_varsel.html'>cv_varsel</a></span>(<span class='no'>dref</span>, <span class='kw'>method</span><span class='kw'>=</span><span class='st'>'l1'</span>) <span class='co'># lasso</span></div><div class='output co'>#&gt; [1] "Performing selection for each fold.."
#&gt;   |                                                                              |                                                                      |   0%  |                                                                              |=======                                                               |  10%  |                                                                              |==============                                                        |  20%  |                                                                              |=====================                                                 |  30%  |                                                                              |============================                                          |  40%  |                                                                              |===================================                                   |  50%  |                                                                              |==========================================                            |  60%  |                                                                              |=================================================                     |  70%  |                                                                              |========================================================              |  80%  |                                                                              |===============================================================       |  90%  |                                                                              |======================================================================| 100%
#&gt; [1] "Performing the selection using all the data.."
#&gt; [1] "Done."</div><div class='input'><span class='fu'><a href='varsel-statistics.html'>varsel_plot</a></span>(<span class='no'>lasso</span>, <span class='kw'>stat</span><span class='kw'>=</span><span class='st'>'rmse'</span>)</div><div class='img'><img src='init_refmodel-1.png' alt='' width='700' height='433' /></div><div class='input'>
</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Juho Piironen, Markus Paasiniemi, Aki Vehtari.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

